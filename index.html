<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Risk Management Pro v4.0</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0f172a; /* Slate 900 */
            color: #e2e8f0;
            padding-top: 100px; 
            padding-bottom: 50px;
            overflow-x: hidden;
        }

        .navbar {
            background-color: rgba(15, 23, 42, 0.95);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid #334155;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 50;
            height: 70px;
        }

        .input-dark {
            background-color: #1e293b;
            border: 1px solid #334155;
            color: white;
            transition: all 0.3s ease;
        }

        .input-dark:focus {
            border-color: #3b82f6;
            outline: none;
            box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.2);
        }

        /* Tab Buttons */
        .tab-btn {
            background-color: transparent;
            color: #94a3b8;
            border: 1px solid #334155;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .tab-btn:hover {
            background-color: #1e293b;
            color: #fff;
        }

        .tab-btn.active {
            background-color: #3b82f6 !important;
            color: white !important;
            border-color: #3b82f6 !important;
            font-weight: bold;
            box-shadow: 0 4px 6px -1px rgba(59, 130, 246, 0.5);
        }

        /* Loading Screen */
        #loading-screen {
            position: fixed;
            inset: 0;
            background-color: #0f172a;
            z-index: 9999;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            transition: opacity 0.5s ease-out;
        }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center px-4">

    <!-- Loading Screen -->
    <div id="loading-screen">
        <div class="animate-spin rounded-full h-16 w-16 border-t-4 border-b-4 border-blue-500 mb-6"></div>
        <h1 class="text-3xl font-bold text-white tracking-wider mb-2">Risk<span class="text-blue-500">Manager</span></h1>
        <p class="text-slate-400 text-sm animate-pulse">Initializing Calculator...</p>
    </div>

    <!-- Navbar -->
    <nav class="navbar px-6 flex justify-between items-center shadow-lg">
        <div class="flex items-center gap-3">
            <div class="bg-blue-600 w-8 h-8 rounded-lg flex items-center justify-center text-white font-bold shadow-blue-500/50 shadow-lg">
                RM
            </div>
            <h1 class="text-lg font-bold text-white tracking-wide">Risk<span class="text-blue-500">Manager</span></h1>
        </div>
        <div class="hidden md:flex gap-6 text-sm font-medium text-slate-400">
            <a href="#" class="text-white hover:text-blue-400 transition">Calculator</a>
            <a href="#" class="hover:text-blue-400 transition">Settings</a>
        </div>
    </nav>

    <!-- Main Container -->
    <div class="w-full max-w-lg bg-slate-800 rounded-2xl shadow-2xl overflow-hidden border border-slate-700 relative z-10">
        
        <!-- Header Container -->
        <div class="bg-slate-900/50 p-4 border-b border-slate-700">
            <h2 class="text-sm font-semibold text-white flex items-center gap-2">
                <i class="fas fa-calculator text-blue-500"></i> Calculator Mode
            </h2>
        </div>

        <!-- Asset Type Selector -->
        <div class="grid grid-cols-4 gap-2 p-4 pb-0">
            <button onclick="changeMode('forex')" id="btn-forex" class="tab-btn active py-3 rounded-lg text-[10px] md:text-xs">
                <i class="fas fa-money-bill-wave block md:inline mb-1 md:mb-0"></i> Forex
            </button>
            <button onclick="changeMode('gold')" id="btn-gold" class="tab-btn py-3 rounded-lg text-[10px] md:text-xs">
                <i class="fas fa-gem block md:inline mb-1 md:mb-0"></i> Gold
            </button>
            <button onclick="changeMode('crypto')" id="btn-crypto" class="tab-btn py-3 rounded-lg text-[10px] md:text-xs">
                <i class="fab fa-bitcoin block md:inline mb-1 md:mb-0"></i> Crypto
            </button>
            <button onclick="changeMode('stock')" id="btn-stock" class="tab-btn py-3 rounded-lg text-[10px] md:text-xs">
                <i class="fas fa-chart-line block md:inline mb-1 md:mb-0"></i> Stock
            </button>
        </div>

        <div class="p-6 space-y-4">
            
            <!-- Forex Options -->
            <div id="forexOptions" style="display: block;" class="bg-slate-700/30 p-3 rounded-lg border border-slate-600">
                <div class="flex items-center justify-between mb-2">
                    <span class="text-xs text-slate-400 font-semibold">Forex Pair Type</span>
                </div>
                <div class="flex gap-2 text-xs">
                    <label class="flex items-center gap-2 cursor-pointer p-1">
                        <input type="radio" name="pairType" value="standard" checked onclick="calculate()" class="accent-blue-500">
                        <span>Standard (.../USD)</span>
                    </label>
                    <label class="flex items-center gap-2 cursor-pointer p-1">
                        <input type="radio" name="pairType" value="cross" onclick="calculate()" class="accent-blue-500">
                        <span>Cross/JPY</span>
                    </label>
                </div>
                <div id="conversionBox" style="display: none;" class="mt-3 pt-2 border-t border-slate-600">
                    <label class="block text-xs font-medium text-yellow-400 mb-1">Conversion Pair Price (USD/XXX)</label>
                    <input type="number" id="conversionRate" placeholder="e.g. 145.50 (USDJPY)" class="input-dark w-full px-3 py-2 rounded text-sm" oninput="calculate()">
                </div>
            </div>

            <!-- Gold Options -->
            <div id="goldOptions" style="display: none;" class="bg-slate-700/30 p-3 rounded-lg border border-slate-600">
                <div class="flex items-center justify-between mb-2">
                    <span class="text-xs text-slate-400 font-semibold">Gold Account Type</span>
                </div>
                <div class="flex gap-4 text-xs">
                    <label class="flex items-center gap-2 cursor-pointer p-1">
                        <input type="radio" name="goldAccountType" value="standard" checked onclick="updateGoldCurrency()" class="accent-yellow-500">
                        <span>Standard (USD)</span>
                    </label>
                    <label class="flex items-center gap-2 cursor-pointer p-1">
                        <input type="radio" name="goldAccountType" value="cent" onclick="updateGoldCurrency()" class="accent-orange-500">
                        <span>Cent (USC)</span>
                    </label>
                </div>
            </div>

            <!-- Stock Options -->
            <div id="stockOptions" style="display: none;" class="bg-slate-700/30 p-3 rounded-lg border border-slate-600">
                <div class="flex items-center justify-between mb-2">
                    <span class="text-xs text-slate-400 font-semibold">Stock Currency</span>
                </div>
                <div class="flex gap-4 text-xs">
                    <label class="flex items-center gap-2 cursor-pointer p-1">
                        <input type="radio" name="stockCurrency" value="idr" checked onclick="updateStockCurrency()" class="accent-red-500">
                        <span>IDR (Rp) - Indo</span>
                    </label>
                    <label class="flex items-center gap-2 cursor-pointer p-1">
                        <input type="radio" name="stockCurrency" value="usd" onclick="updateStockCurrency()" class="accent-green-500">
                        <span>USD ($) - US</span>
                    </label>
                </div>
            </div>

            <!-- Balance & Leverage Row -->
            <div class="flex gap-4">
                <div class="w-full transition-all duration-300" id="balanceContainer">
                    <label class="block text-xs font-medium text-slate-400 mb-1">Account Balance</label>
                    <div class="relative">
                        <span class="absolute left-3 top-3 text-slate-500 currency-symbol">$</span>
                        <input type="number" id="balance" placeholder="1000" class="input-dark w-full pl-10 pr-4 py-2.5 rounded-lg font-semibold" oninput="calculate()">
                    </div>
                </div>
                <div class="w-1/3 transition-all duration-300" id="leverageContainer">
                    <label class="block text-xs font-medium text-slate-400 mb-1">Leverage 1:</label>
                    <input type="number" id="leverage" placeholder="100" class="input-dark w-full px-2 py-2.5 rounded-lg font-semibold text-sm" oninput="calculate()">
                </div>
            </div>

            <!-- Risk Input -->
            <div class="flex gap-4">
                <div class="w-1/2">
                    <label class="block text-xs font-medium text-slate-400 mb-1">Risk Limit</label>
                    <div class="flex items-center">
                        <input type="number" id="riskValue" placeholder="1" class="input-dark w-full px-4 py-2.5 rounded-l-lg font-semibold" oninput="calculate()">
                        <select id="riskType" class="bg-slate-700 border border-l-0 border-slate-600 text-white py-2.5 px-2 rounded-r-lg text-sm outline-none" onchange="calculate()">
                            <option value="percent">%</option>
                            <option value="money" class="currency-symbol-opt">$</option>
                        </select>
                    </div>
                </div>
                <div class="w-1/2">
                    <label class="block text-xs font-medium text-slate-400 mb-1">Max Loss</label>
                    <div class="input-dark w-full px-4 py-2.5 rounded-lg font-semibold text-red-400 bg-opacity-50 flex items-center" id="riskAmountDisplay">
                        0.00
                    </div>
                </div>
            </div>

            <!-- Price Inputs -->
            <div class="grid grid-cols-2 gap-4">
                <div>
                    <label class="block text-xs font-medium text-slate-400 mb-1">Entry Price</label>
                    <input type="number" id="entryPrice" placeholder="0.00" step="any" class="input-dark w-full px-4 py-2.5 rounded-lg font-mono" oninput="calculate()">
                </div>
                <div>
                    <label class="block text-xs font-medium text-slate-400 mb-1">Stop Loss</label>
                    <input type="number" id="stopLoss" placeholder="0.00" step="any" class="input-dark w-full px-4 py-2.5 rounded-lg font-mono border-red-900/50 focus:border-red-500" oninput="calculate()">
                </div>
            </div>

            <!-- Result Card -->
            <div class="bg-gradient-to-br from-slate-700 to-slate-800 rounded-xl p-1 shadow-lg border border-slate-600">
                <div class="bg-slate-800/80 rounded-lg p-4">
                    <div class="flex justify-between items-start mb-2">
                        <span class="text-slate-400 text-xs uppercase font-bold tracking-wider" id="lotLabel">Safe Lot Size</span>
                        <span class="bg-slate-600 text-xs py-0.5 px-2 rounded text-white" id="positionType">Neutral</span>
                    </div>
                    
                    <div class="flex justify-between items-end">
                        <div>
                            <div class="text-3xl font-bold text-white" id="lotResult">0.00</div>
                            <div class="text-slate-400 text-xs mt-1" id="pipsResult">SL Distance: 0</div>
                        </div>
                        <div class="text-right">
                            <div class="text-[10px] text-slate-400 uppercase">Required Margin</div>
                            <div class="text-lg font-bold text-emerald-400" id="marginResult">0.00</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- TPs -->
            <div class="grid grid-cols-3 gap-2 text-center mt-2">
                <div class="bg-slate-700/30 p-2 rounded-lg border border-slate-700/50">
                    <div class="text-[10px] text-slate-500">TP 1:1</div>
                    <div class="text-emerald-400 font-mono text-sm font-bold" id="tp1">0.00</div>
                </div>
                <div class="bg-slate-700/30 p-2 rounded-lg border border-slate-700/50">
                    <div class="text-[10px] text-slate-500">TP 1:2</div>
                    <div class="text-emerald-400 font-mono text-sm font-bold" id="tp2">0.00</div>
                </div>
                <div class="bg-slate-700/30 p-2 rounded-lg border border-slate-700/50">
                    <div class="text-[10px] text-slate-500">TP 1:3</div>
                    <div class="text-emerald-400 font-mono text-sm font-bold" id="tp3">0.00</div>
                </div>
            </div>

            <div id="contractInfo" class="text-[10px] text-slate-500 text-center italic mt-1"></div>

        </div>
    </div>

    <!-- SCRIPT UTAMA (DI GLOBAL SCOPE) -->
    <script>
        // Variabel Global
        let currentMode = 'forex';
        let currentSymbol = '$';

        // Event Listener saat Loading Selesai
        window.onload = function() {
            setTimeout(() => {
                const loader = document.getElementById('loading-screen');
                loader.style.opacity = '0';
                setTimeout(() => {
                    loader.style.display = 'none';
                    // Paksa inisialisasi awal setelah loading hilang
                    changeMode('forex'); 
                }, 500);
            }, 1500); // Tampil selama 1.5 detik
        };

        // --- FUNGSI GLOBAL (Bisa dipanggil onclick) ---

        function changeMode(mode) {
            currentMode = mode;
            console.log("Switching Mode to: " + mode);

            // 1. Tombol
            const buttons = ['forex', 'gold', 'crypto', 'stock'];
            buttons.forEach(b => {
                const btn = document.getElementById('btn-' + b);
                if(btn) btn.classList.remove('active');
            });
            const activeBtn = document.getElementById('btn-' + mode);
            if(activeBtn) activeBtn.classList.add('active');

            // 2. Sembunyikan semua opsi
            const opts = ['forexOptions', 'goldOptions', 'stockOptions'];
            opts.forEach(o => {
                const el = document.getElementById(o);
                if(el) el.style.display = 'none';
            });

            // 3. Reset Layout
            const levContainer = document.getElementById('leverageContainer');
            if(levContainer) levContainer.style.display = 'block';
            
            const balContainer = document.getElementById('balanceContainer');
            if(balContainer) balContainer.className = "w-2/3 transition-all duration-300";
            
            document.getElementById('lotLabel').innerText = "Safe Lot Size";
            document.getElementById('contractInfo').innerHTML = "";

            // 4. Tampilkan opsi sesuai mode
            if (mode === 'forex') {
                document.getElementById('forexOptions').style.display = 'block';
                document.getElementById('entryPrice').placeholder = "1.0850";
                document.getElementById('stopLoss').placeholder = "1.0820";
                setSymbol('$');
            } 
            else if (mode === 'gold') {
                document.getElementById('goldOptions').style.display = 'block';
                document.getElementById('entryPrice').placeholder = "2025.50";
                document.getElementById('stopLoss').placeholder = "2020.00";
                updateGoldCurrency();
            } 
            else if (mode === 'crypto') {
                document.getElementById('entryPrice').placeholder = "65000";
                document.getElementById('stopLoss').placeholder = "64500";
                document.getElementById('lotLabel').innerText = "Unit Size";
                setSymbol('$');
            } 
            else if (mode === 'stock') {
                document.getElementById('stockOptions').style.display = 'block';
                // Sembunyikan Leverage
                if(levContainer) levContainer.style.display = 'none';
                if(balContainer) balContainer.className = "w-full transition-all duration-300";
                
                document.getElementById('lotLabel').innerText = "Shares / Quantity";
                updateStockCurrency();
            }

            calculate();
        }

        function setSymbol(sym) {
            currentSymbol = sym;
            document.querySelectorAll('.currency-symbol').forEach(el => el.innerText = sym);
            const optMoney = document.querySelector('.currency-symbol-opt');
            if (optMoney) optMoney.innerText = sym;
        }

        function updateStockCurrency() {
            if (currentMode !== 'stock') return;
            const radio = document.querySelector('input[name="stockCurrency"]:checked');
            const type = radio ? radio.value : 'idr';
            
            if (type === 'idr') {
                setSymbol('Rp');
                document.getElementById('balance').placeholder = "10000000";
                document.getElementById('entryPrice').placeholder = "5000";
                document.getElementById('stopLoss').placeholder = "4800";
                document.getElementById('contractInfo').innerHTML = "*IDR Mode: 1 Lot = 100 Shares";
            } else {
                setSymbol('$');
                document.getElementById('balance').placeholder = "1000";
                document.getElementById('entryPrice').placeholder = "150.00";
                document.getElementById('stopLoss').placeholder = "145.00";
                document.getElementById('contractInfo').innerHTML = "*USD Mode: US Stock Market";
            }
            calculate();
        }

        function updateGoldCurrency() {
            if (currentMode !== 'gold') return;
            const radio = document.querySelector('input[name="goldAccountType"]:checked');
            const type = radio ? radio.value : 'standard';
            
            if (type === 'cent') {
                setSymbol('USC');
                document.getElementById('balance').placeholder = "10000";
                document.getElementById('contractInfo').innerHTML = "*Cent Account: 1 Lot = 100 oz (Units in USC)";
            } else {
                setSymbol('$');
                document.getElementById('balance').placeholder = "1000";
                document.getElementById('contractInfo').innerHTML = "*Standard Account: 1 Lot = 100 oz";
            }
            calculate();
        }

        function formatMoney(amount) {
            if (currentSymbol === 'Rp') {
                return new Intl.NumberFormat('id-ID', { style: 'currency', currency: 'IDR', maximumFractionDigits: 0 }).format(amount);
            } else if (currentSymbol === 'USC') {
                return amount.toLocaleString('en-US', {
